From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Simon Gander <simongander@gmx.ch>
Date: Tue, 23 Jan 2024 15:16:12 +0100
Subject: [PATCH] 6145: Fix ARM64E_KERNEL chained pointer handling in Mach-O
 binaries (Issue #6144).

---
 .../ghidra/app/util/bin/format/macho/dyld/DyldChainedPtr.java | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/Ghidra/Features/Base/src/main/java/ghidra/app/util/bin/format/macho/dyld/DyldChainedPtr.java b/Ghidra/Features/Base/src/main/java/ghidra/app/util/bin/format/macho/dyld/DyldChainedPtr.java
index 33fb429c4..7b447e972 100644
--- a/Ghidra/Features/Base/src/main/java/ghidra/app/util/bin/format/macho/dyld/DyldChainedPtr.java
+++ b/Ghidra/Features/Base/src/main/java/ghidra/app/util/bin/format/macho/dyld/DyldChainedPtr.java
@@ -186,6 +186,7 @@ public class DyldChainedPtr {
 
 		switch (ptrFormat) {
 			case DYLD_CHAINED_PTR_ARM64E:
+			case DYLD_CHAINED_PTR_ARM64E_KERNEL:
 			case DYLD_CHAINED_PTR_ARM64E_USERLAND:
 			case DYLD_CHAINED_PTR_ARM64E_USERLAND24:
 				return ((chainValue >>> 62) & 1) != 0;
@@ -199,7 +200,6 @@ public class DyldChainedPtr {
 
 			// Never bound
 			case DYLD_CHAINED_PTR_ARM64E_FIRMWARE:
-			case DYLD_CHAINED_PTR_ARM64E_KERNEL:
 			case DYLD_CHAINED_PTR_X86_64_KERNEL_CACHE:
 			case DYLD_CHAINED_PTR_64_KERNEL_CACHE:
 			case DYLD_CHAINED_PTR_32_CACHE:
@@ -356,6 +356,7 @@ public class DyldChainedPtr {
 
 		switch (ptrFormat) {
 			case DYLD_CHAINED_PTR_ARM64E:
+			case DYLD_CHAINED_PTR_ARM64E_KERNEL:
 			case DYLD_CHAINED_PTR_ARM64E_USERLAND:
 				ordinal = chainValue & 0xFFFF;
 				break;
@@ -372,7 +373,6 @@ public class DyldChainedPtr {
 
 			// Never Ordinal
 			case DYLD_CHAINED_PTR_ARM64E_FIRMWARE:
-			case DYLD_CHAINED_PTR_ARM64E_KERNEL:
 			case DYLD_CHAINED_PTR_X86_64_KERNEL_CACHE:
 			case DYLD_CHAINED_PTR_64_KERNEL_CACHE:
 			case DYLD_CHAINED_PTR_32_CACHE:
-- 
2.43.0

