From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: astrelsky <ajs222@njit.edu>
Date: Sat, 1 Aug 2020 13:22:24 -0400
Subject: [PATCH] 2156: Added getDataTypeManager to GhidraScript

---
 .../java/ghidra/app/script/GhidraScript.java  | 26 +++++++++++++++++++
 1 file changed, 26 insertions(+)

diff --git a/Ghidra/Features/Base/src/main/java/ghidra/app/script/GhidraScript.java b/Ghidra/Features/Base/src/main/java/ghidra/app/script/GhidraScript.java
index c702c24252..6837793887 100644
--- a/Ghidra/Features/Base/src/main/java/ghidra/app/script/GhidraScript.java
+++ b/Ghidra/Features/Base/src/main/java/ghidra/app/script/GhidraScript.java
@@ -37,6 +37,7 @@ import ghidra.app.plugin.core.analysis.AnalysisWorker;
 import ghidra.app.plugin.core.analysis.AutoAnalysisManager;
 import ghidra.app.plugin.core.colorizer.ColorizingService;
 import ghidra.app.plugin.core.table.TableComponentProvider;
+import ghidra.app.services.DataTypeManagerService;
 import ghidra.app.services.GoToService;
 import ghidra.app.services.ProgramManager;
 import ghidra.app.tablechooser.TableChooserDialog;
@@ -65,6 +66,7 @@ import ghidra.program.database.ProgramDB;
 import ghidra.program.flatapi.FlatProgramAPI;
 import ghidra.program.model.address.Address;
 import ghidra.program.model.address.AddressSetView;
+import ghidra.program.model.data.DataTypeManager;
 import ghidra.program.model.lang.*;
 import ghidra.program.model.listing.*;
 import ghidra.program.model.listing.CodeUnitFormatOptions.ShowBlockName;
@@ -4085,6 +4087,30 @@ public abstract class GhidraScript extends FlatProgramAPI {
 		return result;
 	}
 
+	/**
+	 * Gets the open DataTypeManager with the corresponding name.
+	 * <br><br>
+	 * NOTE: When using a DataTypeManager that is not the currentProgram's
+	 * it may be necessary to handle the transactions.
+	 * @param name the DataTypeManager's name
+	 * @return the DataTypeManager or null if not found
+	 * @see DataTypeManager#startTransaction(String)
+	 * @see DataTypeManager#endTransaction(int,boolean)
+	 */
+	public DataTypeManager getDataTypeManager(String name) {
+		DataTypeManagerService service = state.getTool().getService(DataTypeManagerService.class);
+		if (service == null) {
+			printerr("The DataTypeManagerService is not enabled");
+			return null;
+		}
+		for (DataTypeManager dtm : service.getDataTypeManagers()) {
+			if (dtm.getName().equals(name)) {
+				return dtm;
+			}
+		}
+		return null;
+	}
+
 	private class ScriptStatusListener implements StatusListener {
 		StringBuilder errors = new StringBuilder();
 
-- 
2.45.1

